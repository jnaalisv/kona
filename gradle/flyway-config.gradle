/**
 * Flyway database migrations, http://flywaydb.org/
 *
 * COMMANDS>
 *
 * $ ./gradlew flywayInfo
 *   shows migration status
 *
 * $ ./gradlew flywayMigrate
 *   migrates database
 *
 *
 * PARAMETERS>
 *
 * -migrationDatabase
 *   Specifies migration target database name
 *
 * -PmigrationHost
 *   Specifies targe host (used for production/test databases)
 *
 *
 * EXAMPLES:
 *
 * update
 * $ ./gradlew flywayMigrate -PmigrationDatabase=kona_test -PmigrationHost=9.9.9.9
 *
 * 2. run migration
 * $ ./gradlew flywayMigrate -PmigrationDatabase=<YOUR_DB_NAME> -Dflyway.baselineOnMigrate=true -Dflyway.baselineVersion=<YOUR_DB_CURRENT_VERSION>
 *
 * 4. check results
 * $ ./gradlew flywayInfo -PmigrationDatabase=<YOUR_DB_NAME>
 *
 * If you want to migrate up to certain version, add -Dflyway.target=<TARGET_VERSION> command line argument
 */

project.ext.migrationDatabase = hasProperty( 'migrationDatabase' ) ? migrationDatabase : 'kona'
project.ext.migrationHost = hasProperty( 'migrationHost' ) ? migrationHost : 'localhost'
project.ext.migrationPort = hasProperty( 'migrationPort' ) ? migrationPort : '5432'

flywayInfo {
    doFirst {
        logger.lifecycle ":$project.name:flywayInfo parameters: database $migrationDatabase@$migrationHost:$migrationPort"
    }
}

flywayMigrate {
    doFirst {
        logger.lifecycle ":$project.name:flywayMigrate parameters: database $migrationDatabase@$migrationHost:$migrationPort"
    }
}

flyway {
    baselineOnMigrate=false
    baselineVersion=999

    //driver = 'com.mysql.jdbc.Driver'
    url = 'jdbc:postgresql://' + migrationHost + ':'+ migrationPort + '/' + migrationDatabase

    user = 'kona'
    password = 'kona'

    // default public schema used
    //schemas = []

    locations = ["filesystem:$rootDir/sql-migrations/"]
}
